---

- include: drush.yml
  when: php_drush

- include: phing.yml
  when: php_phing

- name: Ensure that composer dir doesn't exist in /var/lib
  file:
    path: /var/lib/composer
    state: absent

- name: Move composer modules to /var/lib
  become_user: root
  shell: mv /tmp/vendor /var/lib/composer

- name: Create symlinks to drush bin
  become_user: root
  file:
    src: "/var/lib/composer/bin/{{ item }}"
    dest: "/usr/local/bin/{{ item }}"
    state: link
  with_items: "{{ php_composer_bins }}"

- name: Run drush dl for registry_rebuild
  shell: "drush dl registry_rebuild-7 -y"
  when: php_drush_rr and php_drush_version == "7"

- name: Change .drush dir permissions
  shell: find /home -type d -name ".drush" -exec chmod -R 2777 '{}' ';'
  when: php_drush_rr and php_drush_version == "7"
